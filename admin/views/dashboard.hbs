<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard - CivicConnect</title>
  <style>
    :root{ --bg-1:#0f172a; --accent:#06b6d4; --accent-2:#0ea5a4; --muted:#94a3b8; --radius:14px; --shadow:0 10px 30px rgba(2,6,23,0.12)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Helvetica,Arial;background:
      radial-gradient(1200px 400px at 10% 10%, rgba(6,182,212,0.04), transparent),
      linear-gradient(180deg,#f5f7fb,#eef2f6);color:var(--bg-1)}
    .wrap{width:100vw;height:100vh;display:flex;align-items:stretch;justify-content:center;padding:20px;gap:20px}
    .grid-layout{display:grid;grid-template-columns:280px 1fr;gap:22px;align-items:start;width:100%;height:100%;max-width:none}
    .sidebar{display:flex;flex-direction:column;gap:12px;padding:18px;border-radius:var(--radius);background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(255,255,255,0.94));box-shadow:var(--shadow);border:1px solid rgba(15,23,42,0.03);height:100%;overflow:auto;position:sticky;top:0;z-index:5}
    .profile{display:flex;gap:12px;align-items:center}
    .avatar{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,#ecfeff,#dbeafe);display:flex;align-items:center;justify-content:center;font-weight:800;color:#0f172a;font-size:22px;box-shadow:0 8px 20px rgba(6,182,212,0.06)}
    .userMeta .name{font-weight:800;font-size:16px}
    .userMeta .email{font-size:13px;color:var(--muted);margin-top:4px}
    .nav{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .nav a{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;color:var(--bg-1);text-decoration:none;font-weight:700}
    .nav a.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 8px 22px rgba(14,165,164,0.12)}
    .nav a:hover{background:#f1f9f8}
    .small{font-size:13px;color:var(--muted);margin-top:auto}
    .main{display:flex;flex-direction:column;gap:18px;height:100%;overflow:hidden;border-radius:var(--radius)}
    .mainInner{display:flex;flex-direction:column;padding:18px;background:linear-gradient(180deg,rgba(255,255,255,0.98),#fff);box-shadow:var(--shadow);border:1px solid rgba(15,23,42,0.03);height:100%;overflow:auto;border-radius:var(--radius)}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;position:relative;top:0;padding:10px 0 8px 0;z-index:10;background:linear-gradient(180deg,rgba(255,255,255,0.98),#fff);backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid rgba(15,23,42,0.06)}
    .title h1{margin:0;font-size:20px}
    .sub{color:var(--muted);font-size:13px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:800}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;box-shadow:0 10px 30px rgba(6,182,212,0.12)}
    .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-top:6px}
    .stat-card{border-radius:12px;padding:18px;background:linear-gradient(180deg,rgba(255,255,255,0.95),#fff);box-shadow: 0 12px 40px rgba(2,6,23,0.04);border:1px solid rgba(15,23,42,0.03)}
    .stat-card .label{font-size:13px;color:var(--muted)}
    .stat-card .value{font-size:26px;font-weight:900;margin-top:6px}

    /* charts layout */
    .charts{display:grid;grid-template-columns:2fr 1fr;gap:16px;margin-top:8px}
    .chart-card{border-radius:12px;padding:16px;background:linear-gradient(180deg,rgba(255,255,255,0.98),#fff);box-shadow:0 12px 30px rgba(2,6,23,0.04);border:1px solid rgba(15,23,42,0.03)}
    .chart-title{margin:0 0 8px 0;font-size:14px;color:var(--muted)}
    .afterTopbar{padding-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid-layout">
      <aside class="sidebar">
        <div class="profile">
          <div class="avatar">A</div>
          <div class="userMeta">
            <div class="name">{{username}}</div>
            <div class="email">Admin</div>
          </div>
        </div>
        <nav class="nav">
          <a href="/admin" class="active">Overview</a>
          <a href="/admin/users">Users</a>
          <a href="/admin/reports">Reports</a>
          <a href="/admin/settings">Settings</a>
        </nav>
        <div class="small">Admin panel</div>
      </aside>

      <main class="main">
        <div class="mainInner">
          <div class="topbar">
            <div class="title">
              <h1>Admin overview</h1>
              <div class="sub">Platform-wide metrics</div>
            </div>
            <div style="display:flex;gap:10px">
              <button class="btn btn-primary" onclick="location.href='/admin/settings'">Settings</button>
              <button class="btn btn-ghost" onclick="location.href='/admin/logout'">Log out</button>
            </div>
          </div>

          <div class="afterTopbar">
          <section class="stats">
            <div class="stat-card"><div class="label">Total Users</div><div class="value">{{usersCount}}</div></div>
            <div class="stat-card"><div class="label">Total Reports</div><div class="value">{{reportsCount}}</div></div>
            <div class="stat-card"><div class="label">Open Reports</div><div class="value">{{openCount}}</div></div>
            <div class="stat-card"><div class="label">Resolved Reports</div><div class="value">{{resolvedCount}}</div></div>
          </section>

          <section class="charts" aria-label="Analytics">
            <div class="chart-card">
              <h3 class="chart-title">Incident trend (last 12 weeks)</h3>
              <canvas id="trendChart" height="120"></canvas>
            </div>
            <div class="chart-card">
              <h3 class="chart-title">SLA compliance</h3>
              <canvas id="slaChart" height="120"></canvas>
            </div>
          </section>

          <section class="charts" aria-label="Operational mix">
            <div class="chart-card">
              <h3 class="chart-title">Status distribution</h3>
              <canvas id="statusChart" height="120"></canvas>
            </div>
            <div class="chart-card">
              <h3 class="chart-title">Category mix</h3>
              <canvas id="categoryChart" height="120"></canvas>
            </div>
          </section>

          <section style="margin-top:12px;display:grid;grid-template-columns:2fr 1fr;gap:16px">
            <div class="panel" style="padding:12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.98),#fff);box-shadow:0 12px 30px rgba(2,6,23,0.04);border:1px solid rgba(15,23,42,0.03)">
              <h3 style="margin:0 0 8px 0">Operational feed</h3>
              <div class="sub">Recent escalations, SLA breaches, and assignments.</div>
              <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
                {{#if feed}}
                  {{#each feed}}
                    <div style="display:flex;justify-content:space-between;align-items:center;border:1px solid rgba(15,23,42,0.06);border-radius:10px;padding:10px">
                      <div>
                        <div style="font-weight:800">{{this.title}}</div>
                        <div class="sub">{{this.time}} â€¢ {{this.meta}}</div>
                      </div>
                      <span style="padding:6px 10px;border-radius:999px;background:#ecfeff;color:#0369a1;font-weight:800">{{this.type}}</span>
                    </div>
                  {{/each}}
                {{else}}
                  <div class="muted">No events yet.</div>
                {{/if}}
              </div>
            </div>

            <div class="panel" style="padding:12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.98),#fff);box-shadow:0 12px 30px rgba(2,6,23,0.04);border:1px solid rgba(15,23,42,0.03)">
              <h3 style="margin:0 0 8px 0">Quick actions</h3>
              <div style="display:flex;flex-direction:column;gap:10px">
                <button class="btn btn-primary" onclick="location.href='/admin/reports'">Review new reports</button>
                <button class="btn btn-ghost" onclick="location.href='/admin/users'">Manage users</button>
                <button class="btn btn-ghost" onclick="location.href='/admin/settings'">Admin settings</button>
              </div>
            </div>
          </section>

          {{!-- Recent reports moved to /admin/reports. Recent users remains hidden. --}}
          </div>
        </div>
      </main>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script>
  (function(){
    if (!window.Chart) return;
    const accent = '#06b6d4';
    const accent2 = '#0ea5a4';

    const ctx1 = document.getElementById('trendChart');
    if (ctx1) {
      const labels = {{#if trendLabels}}{{{trendLabels}}}{{else}}["W1","W2","W3","W4","W5","W6","W7","W8","W9","W10","W11","W12"]{{/if}};
      const data = {{#if trendData}}{{{trendData}}}{{else}}[28,32,30,38,35,40,44,43,39,42,47,50]{{/if}};
      new Chart(ctx1, {
        type: 'line',
        data: { labels, datasets: [{ label: 'Incidents', data, borderColor: accent, backgroundColor: 'rgba(6,182,212,0.15)', fill: true, tension: 0.35, borderWidth: 2 }]},
        options: { plugins: { legend: { display: false }}, scales: { x: { grid: { display:false }}, y: { grid: { color: 'rgba(15,23,42,0.06)'}}}}
      });
    }

    const ctx2 = document.getElementById('slaChart');
    if (ctx2) {
      const compliant = {{#if slaCompliant}}{{slaCompliant}}{{else}}92{{/if}}; const breach = {{#if slaBreach}}{{slaBreach}}{{else}}8{{/if}};
      new Chart(ctx2, {
        type: 'doughnut',
        data: { labels: ['Compliant','Breach'], datasets: [{ data: [compliant, breach], backgroundColor: [accent2, '#fde68a'], borderWidth: 0 }]},
        options: { plugins: { legend: { position: 'bottom' }}, cutout: '65%'}
      });
    }

    const ctx3 = document.getElementById('statusChart');
    if (ctx3) {
      new Chart(ctx3, {
        type: 'bar',
        data: {
          labels: {{#if statusLabels}}{{{statusLabels}}}{{else}}["open","in_progress","resolved"]{{/if}},
          datasets: [{ label: 'Count', data: {{#if statusData}}{{{statusData}}}{{else}}[18,11,27]{{/if}}, backgroundColor: ['#bae6fd','#fde68a','#bbf7d0'], borderWidth: 0 }]
        },
        options: { plugins: { legend: { display: false }}, scales: { y: { beginAtZero: true }}}
      });
    }

    const ctx4 = document.getElementById('categoryChart');
    if (ctx4) {
      new Chart(ctx4, {
        type: 'polarArea',
        data: {
          labels: {{#if categoryLabels}}{{{categoryLabels}}}{{else}}["Roads","Water","Electricity","Sanitation"]{{/if}},
          datasets: [{ data: {{#if categoryData}}{{{categoryData}}}{{else}}[35,22,18,15]{{/if}}, backgroundColor: ['#bae6fd','#bbf7d0','#fecaca','#fde68a'], borderWidth: 0 }]
        },
        options: { plugins: { legend: { position: 'bottom' }}}
      });
    }
  })();
  </script>
</body>
</html>
