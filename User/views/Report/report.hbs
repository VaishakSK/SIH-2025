<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Create Report - CivicConnect</title>
  <style>
    :root{
      --bg1:#f0f4f8; --bg2:#eaf2f7;
      --card:#ffffff; --muted:#616b7a;
      --accent:#06b6d4; --accent-2:#0ea5a4;
      --danger:#dc2626;
      --radius:14px; --shadow: 0 12px 40px rgba(2,6,23,0.06);
      --max-width:1400px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:
      linear-gradient(180deg,var(--bg1),var(--bg2));color:#071023}
    /* full-screen layout */
    .stage{width:100vw;height:100vh;display:flex;align-items:stretch;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:var(--max-width);height:100%;display:grid;grid-template-columns:1fr 420px;gap:24px}
    @media (max-width:1100px){ .wrap{grid-template-columns:1fr} }

    .panel{
      background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:26px;display:flex;flex-direction:column;gap:18px;border:1px solid rgba(7,16,35,0.04);overflow:auto;
    }

    .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{display:flex;flex-direction:column}
    .title h1{margin:0;font-size:20px;font-weight:800}
    .title p{margin:4px 0 0 0;color:var(--muted);font-size:13px}

    /* global fixed back button (top-left) */
    .global-back{
      position:fixed;
      left:20px;
      top:20px;
      z-index:999;
      box-shadow:0 6px 18px rgba(2,6,23,0.08);
      background:transparent;
    }

    form{display:flex;flex-direction:column;gap:18px}

    /* form layout */
    .fields{display:grid;grid-template-columns:1fr;gap:14px}
    .row{display:flex;gap:14px}
    .col{flex:1;display:flex;flex-direction:column;gap:8px}
    label{font-weight:700;font-size:14px}
    input[type="text"], select, textarea{
      padding:12px;border-radius:10px;border:1px solid rgba(7,16,35,0.06);font-size:14px;background:linear-gradient(180deg, #fff, #fbfdfe);
      outline:none;
    }
    textarea{min-height:160px;resize:vertical}
    .muted{font-size:13px;color:var(--muted)}

    /* image drop area */
    .drop{
      height:380px;border-radius:12px;border:2px dashed rgba(7,16,35,0.06);display:flex;align-items:center;justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), transparent);position:relative;overflow:hidden;
    }
    .drop.hover{border-color:rgba(6,182,212,0.8);box-shadow:0 10px 30px rgba(6,182,212,0.06)}
    .drop .placeholder{text-align:center;color:var(--muted)}
    .preview-img{width:100%;height:100%;object-fit:cover;display:block}

    .side{
      display:flex;flex-direction:column;gap:14px;
    }
    .card{background:linear-gradient(180deg,#fff,#fbfdfe);border-radius:12px;padding:14px;border:1px solid rgba(7,16,35,0.04)}
    .btn{
      display:inline-flex;align-items:center;gap:10px;padding:12px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;font-weight:800;cursor:pointer;
      box-shadow:0 10px 30px rgba(6,182,212,0.12)
    }
    .btn-ghost{background:transparent;border:1px solid rgba(7,16,35,0.06);color:#071023;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}

    .meta-row{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .wordcount{font-weight:700}
    .progress{height:8px;background:#eef6f8;border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%}

    /* footer */
    .actions{display:flex;gap:12px;align-items:center;justify-content:flex-end;margin-top:6px}

    @media (max-width:760px){
      .drop{height:260px}
      .wrap{padding:12px}
      .side{order:2}
    }
  </style>
</head>
<body>
  {{> header}}

  <div class="stage">
    <div class="wrap">
      <div class="panel">
        <h2>Create Report</h2>

        <form id="finalForm" method="POST" action="{{#if report}}/report/submit/{{report._id}}{{else}}/report{{/if}}">
          <div style="display:grid;grid-template-columns:1fr 420px;gap:18px">
            <div>
              {{#if report}}
                {{#if report.imagePath}}
                  <img src="{{report.imagePath}}" alt="Attached image" style="width:100%;border-radius:8px">
                {{/if}}
              {{else}}
                <label for="photo">Attach photo</label>
                <input type="file" id="photo" name="photo" accept="image/*" required>
              {{/if}}
            </div>

            <aside>
              <div>
                <label>Title</label>
                <input id="title" name="title" value="{{report.title}}" required placeholder="1–10 words">
              </div>

              <div style="margin-top:8px">
                <label>Department</label>
                <select name="department">
                  <option {{#ifEquals report.department "sanitation"}}selected{{/ifEquals}} value="sanitation">Sanitation</option>
                  <option {{#ifEquals report.department "roads"}}selected{{/ifEquals}} value="roads">Roads & Infrastructure</option>
                  <option {{#ifEquals report.department "electricity"}}selected{{/ifEquals}} value="electricity">Electricity</option>
                  <option {{#ifEquals report.department "water"}}selected{{/ifEquals}} value="water">Water Supply</option>
                  <option {{#ifEquals report.department "others"}}selected{{/ifEquals}} value="others">Others</option>
                </select>
              </div>

              <div style="margin-top:8px">
                <label>Address</label>
                <input id="address" name="address" value="{{report.address}}" required>
                <div style="margin-top:6px" class="muted">You can edit the address</div>
              </div>

              <div style="margin-top:8px">
                <label for="description">Description</label>
                <textarea id="description" name="description" required>{{report.description}}</textarea>
                <div id="wordCount" class="muted">Words: 0</div>
              </div>

              <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
                <a class="btn-ghost" href="/report">Cancel</a>
                <button class="btn" type="submit">Submit</button>
              </div>

              <!-- keep geo hidden fields (pre-populated from draft) -->
              <input type="hidden" name="locationText" value="{{report.locationText}}">
            </aside>
          </div>
        </form>
      </div>
    </div>
  </div>

  {{> footer}}

  <script>
    (function(){
      // word count
      const desc = document.getElementById('description');
      const wc = document.getElementById('wordCount');
      function countWords(t){ if(!t) return 0; return t.trim().split(/\s+/).filter(Boolean).length; }
      function update(){ wc.textContent = 'Words: ' + countWords(desc.value || ''); }
      desc && desc.addEventListener('input', update);
      update();

      // simple client validation for title/desc on submit
      const form = document.getElementById('finalForm');
      form && form.addEventListener('submit', function(e){
        const t = document.getElementById('title');
        const tWords = (t.value||'').trim().split(/\s+/).filter(Boolean).length;
        if (tWords < 1 || tWords > 10){ e.preventDefault(); alert('Title must be 1–10 words'); t.focus(); return; }
        const d = countWords(desc.value || '');
        if (d < 30 || d > 250){ e.preventDefault(); alert('Description must be 30–250 words'); desc.focus(); return; }
      });
    })();
  </script>
</body>
</html>