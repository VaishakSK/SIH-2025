<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>My Reports - CivicConnect</title>
  <style>
    :root{
      --bg:#f3f6f9; --card:#fff; --muted:#64748b;
      --accent:#06b6d4; --radius:12px; --shadow:0 8px 30px rgba(2,6,23,0.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#fff);color:#071023}
    .stage{min-height:100vh;padding:28px}
    .container{max-width:1400px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    @media(max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:700px){.grid{grid-template-columns:1fr}}

    .card{
      background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow);border:1px solid rgba(7,16,35,0.04);
      display:flex;flex-direction:column;height:100%;
    }
    .thumb{height:180px;border-radius:10px;overflow:hidden;background:#f7fbfc;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .info{padding:12px 0;flex:1;display:flex;flex-direction:column;gap:8px}
    .title{font-weight:800;font-size:16px}
    .meta{font-size:13px;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap}
    .badge{padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,#ecfeff,#bbf7d0);color:#064e3b;font-weight:800;font-size:13px}
    .actions{display:flex;gap:8px;align-items:center}
    .btn{position:relative;overflow:hidden; padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,#06b6d4,#0ea5a4);color:rgb(0, 0, 0);font-weight:900;text-decoration:none;box-shadow:0 10px 26px rgba(6,182,212,0.2);transition:transform .18s ease, box-shadow .18s ease, filter .18s ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 14px 36px rgba(6,182,212,0.28)}
    .btn:active{transform:translateY(0) scale(0.98);filter:saturate(110%)}
    .btn-ghost{position:relative;overflow:hidden; padding:10px 14px;border-radius:10px;border:1px solid rgba(7,16,35,0.08);background:linear-gradient(180deg,#ffffff,#f8fafc);color:#071023;text-decoration:none;font-weight:800;transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease}
    .btn-ghost:hover{transform:translateY(-2px);box-shadow:0 10px 26px rgba(2,6,23,0.08);border-color:rgba(7,16,35,0.16)}
    .btn-ghost:active{transform:translateY(0) scale(0.98)}
    .btn-outline{position:relative;overflow:hidden; padding:10px 14px;border-radius:10px;border:1px solid #06b6d4;background:transparent;color:#06b6d4;font-weight:900;text-decoration:none;transition:transform .18s ease, box-shadow .18s ease, color .18s ease, border-color .18s ease}
    .btn-outline:hover{transform:translateY(-2px);box-shadow:0 10px 26px rgba(6,182,212,0.18);color:#0ea5a4;border-color:#0ea5a4}
    .btn-outline:active{transform:translateY(0) scale(0.98)}
    .ripple{position:absolute;border-radius:50%;transform:scale(0);animation:ripple .6s linear;background:rgba(255,255,255,0.5);pointer-events:none}
    @keyframes ripple{to{transform:scale(4);opacity:0}}
    .status-line{font-size:12px;color:var(--muted)}
    .empty{padding:40px;text-align:center;color:var(--muted);background:linear-gradient(180deg,#fff,#fbfdfe);border-radius:12px;box-shadow:var(--shadow)}

    /* global fixed back button (top-left) */
    .global-back{
      position:fixed;
      left:20px;
      top:20px;
      z-index:999;
      box-shadow:0 6px 18px rgba(2,6,23,0.08);
      background:transparent;
    }
    @media(max-width:520px){
      .global-back{left:12px;top:12px;padding:8px 10px}
    }
  </style>
</head>
<body>
  {{> header}}

  <div class="stage">
    <div class="container">
      <h1 style="margin:0 0 14px 0; font: size 50px">My Reports</h1>
      <div style="display:flex;gap:10px;align-items:center;margin-bottom:14px">
        <a href="/report" class="btn" style="text-decoration:none">Create Report</a>
      </div>
      {{#if reports.length}}
      <div class="grid" aria-live="polite">
        {{#each reports}}
        <article class="card" role="article">
          <div class="thumb">
            <img src="{{this.imagePath}}" alt="{{this.title}}">
          </div>
          <div class="info">
            <div class="title">{{this.title}}</div>
            <div class="meta">
              <div>{{this.department}}</div>
              <div>â€¢</div>
              <div>{{this.createdAtFormatted}}</div>
              <div style="margin-left:auto"><span class="badge">{{this.status}}</span></div>
            </div>
            <div class="muted" style="margin-top:6px;flex:1;overflow:hidden;text-overflow:ellipsis">{{this.address}}</div>
            <div class="actions">
              <a class="btn-ghost" href="/reports/{{this._id}}">View</a>
              {{#if (eq this.status "open")}}
                <a class="btn" href="/reports/{{this._id}}/edit">Edit</a>
              {{else}}
                <a class="btn-ghost" style="opacity:0.6;pointer-events:none">Edit</a>
              {{/if}}
              <button type="button" class="btn-outline" onclick="trackStatus('{{this._id}}')">Track status</button>
              <form action="/reports/{{this._id}}/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this report?');">
                <button type="submit" class="btn-ghost" style="background-color: #fee2e2; color: #b91c1c;">Delete</button>
              </form>
            </div>
          </div>
        </article>
        {{/each}}
      </div>
      {{else}}
        <div class="empty">You have no reports yet. Click <a href="/report" style="color:var(--accent)">Create Report</a> to file your first issue.</div>
      {{/if}}
    </div>
  </div>

  {{> footer}}
</body>
</html>
<script>
  // ripple on buttons
  function addRipple(e){
    const target = e.currentTarget;
    const circle = document.createElement('span');
    const diameter = Math.max(target.clientWidth, target.clientHeight);
    const rect = target.getBoundingClientRect();
    circle.style.width = circle.style.height = `${diameter}px`;
    circle.style.left = `${e.clientX - rect.left - diameter/2}px`;
    circle.style.top = `${e.clientY - rect.top - diameter/2}px`;
    circle.classList.add('ripple');
    const old = target.getElementsByClassName('ripple')[0];
    if (old) old.remove();
    target.appendChild(circle);
  }
  document.addEventListener('click', function(e){
    const el = e.target.closest('.btn, .btn-ghost, .btn-outline');
    if (el) addRipple(e);
  });

  async function trackStatus(id){
    try{
      const res = await fetch(`/reports/${id}/status`, { headers: { 'Accept': 'application/json' } });
      const data = await res.json();
      if(!data.success){
        showNotification(data.message || 'Could not fetch status', 'error');
        return;
      }
      const message = `Status: ${data.status}\nUpdated: ${data.updatedAtFormatted} (${data.updatedAgo})`;
      showDialog('Report status', message, { buttons: [ { text: 'Close', onClick: () => {} } ] });
    }catch(e){
      showNotification('Error fetching status', 'error');
    }
  }
</script>